<!DOCTYPE html>
<html lang="es">
<head>
ย ย <meta charset="UTF-8">
ย ย <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
ย ย <meta name="apple-mobile-web-app-capable" content="yes">
ย ย <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
ย ย <meta name="theme-color" content="#0a0a0a">
ย ย <title>Fit Data by Toni</title>
ย ยย
ย ย <link rel="apple-touch-icon" href="logo.png">
ย ย <link rel="icon" type="image/png" href="logo.png">
ย ยย
ย ย <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
ย ย <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
ย ย <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
ย ย <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
ย ยย
ย ย <style>
ย ย ย ย :root {
ย ย ย ย ย ย --bg: #0a0a0a;ย
ย ย ย ย ย ย --card: #1a1a1a;ย
ย ย ย ย ย ย --card-light: #222;
ย ย ย ย ย ย --text: #ffffff;ย
ย ย ย ย ย ย --muted: #888888;
ย ย ย ย ย ย --accent: #ff4444;ย ย ย ย
ย ย ย ย ย ย --accent-glow: rgba(255, 68, 68, 0.25);
ย ย ย ย ย ย --success: #22dd88;ย
ย ย ย ย ย ย --warning: #ffaa00;
ย ย ย ย ย ย --safe-top: env(safe-area-inset-top);
ย ย ย ย ย ย --safe-bottom: env(safe-area-inset-bottom);
ย ย ย ย }
ย ย ย ยย
ย ย ย ย * { margin:0; padding:0; box-sizing:border-box; font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; -webkit-tap-highlight-color:transparent; outline:none; }
ย ย ย ยย
ย ย ย ย body {ย
ย ย ย ย ย ย background:var(--bg); color:var(--text);ย
ย ย ย ย ย ย min-height:100vh;ย
ย ย ย ย ย ย padding-bottom: calc(100px + var(--safe-bottom));ย
ย ย ย ย ย ย overscroll-behavior-y:none;ย
ย ย ย ย ย ย user-select: none;ย
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .hidden { display:none !important; }
ย ย ย ย .container { max-width:600px; margin:0 auto; padding:20px; padding-top:15px; }
ย ย ย ย .text-accent { color:var(--accent); }
ย ย ย ย .text-muted { color:var(--muted); font-size:0.8rem; }
ย ย ย ย .text-center { text-align: center; }
ย ย ย ย h1, h2, h3 { font-weight:800; letter-spacing:-0.5px; margin-bottom:10px; }

ย ย ย ย /* HEADER FIJO */
ย ย ย ย .navbar-top {
ย ย ย ย ย ย position: sticky; top: 0; z-index: 100;
ย ย ย ย ย ย background: rgba(20, 20, 20, 0.98);
ย ย ย ย ย ย backdrop-filter: blur(15px);
ย ย ย ย ย ย border-bottom: 1px solid #333;
ย ย ย ย ย ย padding: 15px 20px;
ย ย ย ย ย ย padding-top: calc(20px + var(--safe-top));ย
ย ย ย ย ย ย display: flex; justify-content: space-between; align-items: center;
ย ย ย ย ย ย box-shadow: 0 4px 20px rgba(0,0,0,0.5);
ย ย ย ย }

ย ย ย ย /* INPUTS & BOTONES */
ย ย ย ย .btn { width:100%; padding:14px; border:none; border-radius:12px; font-weight:700; font-size:0.95rem; cursor:pointer; display:flex; align-items:center; justify-content:center; gap:8px; margin-bottom:10px; transition:0.2s; }
ย ย ย ย .btn:active { transform:scale(0.98); }
ย ย ย ย .btn-primary { background:var(--accent); color:white; box-shadow:0 0 15px var(--accent-glow); }
ย ย ย ย .btn-secondary { background:rgba(255,255,255,0.1); border:1px solid #444; color:white; }
ย ย ย ย .btn-success { background:var(--success); color:black; font-weight:800; }
ย ย ย ย .btn-icon { background:transparent; border:none; color:#bbb; font-size:1.2rem; cursor:pointer; padding: 5px; border-radius: 5px; border: 1px solid #333; min-width: 40px;}
ย ย ย ย .btn-icon:hover { color:white; border-color: #666; background: #333; }

ย ย ย ย .input { width:100%; padding:14px; margin-bottom:12px; background:#222; border:1px solid #444; color:white; border-radius:10px; font-size:1rem; }
ย ย ย ย .input:focus { border-color:var(--accent); background:#2a2a2a; }

ย ย ย ย /* CARDS */
ย ย ย ย .card { background:var(--card); padding:20px; border-radius:16px; margin-bottom:15px; border:1px solid #2a2a2a; border-left:4px solid var(--accent); position:relative; }
ย ย ย ยย
ย ย ย ย /* EXERCISE IMAGE (JPG) */
ย ย ย ย .ex-img { width: 65px; height: 65px; background: white; border: 2px solid var(--accent); border-radius: 12px; padding: 0; object-fit: cover; flex-shrink: 0; }

ย ย ย ย /* WORKOUT ROWS */
ย ย ย ย .set-row {ย
ย ย ย ย ย ย display:grid; grid-template-columns:30px 1fr 1fr 40px 40px; gap:8px; align-items:center;ย
ย ย ย ย ย ย background:#1a1a1a; padding:10px; border-radius:8px; margin-bottom:8px; border:1px solid #333;ย
ย ย ย ย }
ย ย ย ย .set-row.done { border-color:var(--success); background:rgba(34, 221, 136, 0.05); }
ย ย ย ย .prev-val { position:absolute; top:-8px; left:50%; transform:translateX(-50%); font-size:0.65rem; color:#888; background:#222; padding:0 6px; border-radius:4px; border:1px solid #444; z-index:5; pointer-events:none; }

ย ย ย ย .check-btn { width:32px; height:32px; border-radius:50%; border:2px solid #555; background:transparent; display:flex; align-items:center; justify-content:center; cursor:pointer; color:transparent; font-weight:bold; transition:0.2s; }
ย ย ย ย .check-btn.checked { background:var(--success); border-color:var(--success); color:black; transform:scale(1.1); }
ย ย ย ย .check-btn.checked::after { content:'โ'; }

ย ย ย ย /* NAV BOTTOM */
ย ย ย ย .nav-bottom {ย
ย ย ย ย ย ย position:fixed; bottom:0; left:0; width:100%;ย
ย ย ย ย ย ย background:rgba(20,20,20,0.98); border-top:1px solid #333;ย
ย ย ย ย ย ย display:flex; justify-content:space-around; padding:12px 0;ย
ย ย ย ย ย ย padding-bottom: calc(15px + var(--safe-bottom));ย
ย ย ย ย ย ย z-index:100; backdrop-filter: blur(10px);
ย ย ย ย }
ย ย ย ย .nav-item { color:#666; background:none; border:none; font-size:0.65rem; display:flex; flex-direction:column; align-items:center; width:20%; font-weight:700; text-transform:uppercase; letter-spacing:0.5px; transition:0.3s; }
ย ย ย ย .nav-item.active { color:var(--accent); transform:translateY(-3px); text-shadow:0 0 10px var(--accent-glow); }
ย ย ย ย .nav-item i { font-size:1.4rem; margin-bottom:4px; font-style:normal; }

ย ย ย ย /* MODALS */
ย ย ย ย .screen { display:none; opacity:0; transition:opacity 0.3s; }
ย ย ย ย .screen.active { display:block; opacity:1; }
ย ย ย ย .modal { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:5000; display:flex; align-items:center; justify-content:center; backdrop-filter:blur(5px); }
ย ย ย ย .modal-content { background:var(--card); width:95%; max-width:500px; padding:25px; border-radius:20px; border:1px solid #444; max-height:85vh; overflow-y:auto; box-shadow:0 10px 40px rgba(0,0,0,0.8); }

ย ย ย ย /* TIMER FLOAT */
ย ย ย ย .timer-float { position:fixed; bottom:calc(100px + var(--safe-bottom)); right:20px; width:70px; height:70px; background:var(--bg); border:3px solid var(--accent); border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:1.4rem; font-family:monospace; color:var(--accent); box-shadow:0 0 20px var(--accent-glow); z-index:2000; cursor:pointer; animation:pulse 1s infinite; }
ย ย ย ย @keyframes pulse { 0% {box-shadow:0 0 0 0 rgba(255,68,68,0.4);} 70% {box-shadow:0 0 0 10px rgba(255,68,68,0);} 100% {box-shadow:0 0 0 0 rgba(255,68,68,0);} }

ย ย ย ย /* TOAST */
ย ย ย ย #toast { visibility:hidden; min-width:250px; background-color:#222; color:#fff; text-align:center; border-radius:50px; padding:12px 24px; position:fixed; z-index:6000; left:50%; bottom:calc(100px + var(--safe-bottom)); transform:translateX(-50%); border:1px solid var(--accent); box-shadow:0 5px 20px rgba(0,0,0,0.6); font-size:0.9rem; font-weight:bold; }
ย ย ย ย #toast.show { visibility:visible; animation:fadein 0.5s, fadeout 0.5s 2.5s; }
ย ย ย ย @keyframes fadein { from{bottom:60px; opacity:0;} to{bottom:calc(100px + var(--safe-bottom)); opacity:1;} }
ย ย ย ย @keyframes fadeout { from{bottom:calc(100px + var(--safe-bottom)); opacity:1;} to{bottom:60px; opacity:0;} }

ย ย ย ย /* ADMIN LIST */
ย ย ย ย .user-row { display:flex; justify-content:space-between; align-items:center; padding:15px; background:var(--card-light); border-radius:10px; margin-bottom:10px; border-left:3px solid #444; }
ย ย ย ย .stagnant { border-left-color: var(--warning) !important; background: rgba(255, 170, 0, 0.05); }
ย ย ย ยย
ย ย ย ย /* LOGO */
ย ย ย ย .loading-logo { width:140px; height:140px; margin-bottom:20px; border-radius:30px; animation:heartbeat 2.5s infinite ease-in-out; box-shadow:0 0 50px rgba(255,68,68,0.3); }
ย ย ย ย @keyframes heartbeat { 0% {transform:scale(1);} 50% {transform:scale(1.08);} 100% {transform:scale(1);} }

ย ย ย ย /* HEATMAP CONTAINERS */
ย ย ย ย .heatmap-wrapper { display: flex; justify-content: center; gap: 20px; height: 350px; }
ย ย ย ย .body-svg { height: 100%; width: auto; filter: drop-shadow(0 0 5px rgba(255,68,68,0.2)); }
ย ย </style>
</head>
<body>

ย ย <div id="toast">Notificaciรณn</div>

ย ย <div id="loading" class="screen active" style="text-align:center; padding-top:30vh; background:#000; z-index:9999;">
ย ย ย ย <img src="logo.png" class="loading-logo">
ย ย ย ย <h1 style="color:var(--accent); font-size:3.5rem; margin:0; letter-spacing:-2px;">FIT DATA</h1>
ย ย ย ย <p style="color:var(--muted); margin-top:10px; font-size:1.1rem; letter-spacing:1px;">COACH INTELLIGENCE</p>
ย ย </div>

ย ย <div id="login" class="screen">
ย ย ย ย <div class="container" style="padding-top:60px; text-align:center;">
ย ย ย ย ย ย <img src="logo.png" style="width:100px; border-radius:20px; margin-bottom:20px; box-shadow:0 0 20px rgba(255,68,68,0.2);">
ย ย ย ย ย ย <h1 style="color:var(--accent); font-size:3rem; margin-bottom:10px;">FIT DATA</h1>
ย ย ย ย ย ย <p style="color:var(--muted); margin-bottom:40px;">Acceso Atletas</p>
ย ย ย ย ย ย <div class="card" style="border:none; background:transparent;">
ย ย ย ย ย ย ย ย <input id="log-email" class="input" type="email" placeholder="Email">
ย ย ย ย ย ย ย ย <input id="log-pass" class="input" type="password" placeholder="Contraseรฑa">
ย ย ย ย ย ย ย ย <button onclick="doLogin()" class="btn btn-primary">INICIAR SESIรN</button>
ย ย ย ย ย ย ย ย <p onclick="toRegister()" style="margin-top:20px; color:var(--muted); cursor:pointer; font-size:0.9rem;">Solicitar Acceso</p>
ย ย ย ย ย ย </div>
ย ย ย ย </div>
ย ย </div>

ย ย <div id="register" class="screen">
ย ย ย ย <div class="container" style="padding-top:20px;">
ย ย ย ย ย ย <h2 class="text-center text-accent">Nuevo Atleta</h2>
ย ย ย ย ย ย <div class="card">
ย ย ย ย ย ย ย ย <input id="reg-name" class="input" placeholder="Nombre Completo">
ย ย ย ย ย ย ย ย <input id="reg-age" type="number" class="input" placeholder="Edad">
ย ย ย ย ย ย ย ย <input id="reg-height" type="number" class="input" placeholder="Altura (cm)">
ย ย ย ย ย ย ย ย <input id="reg-email" class="input" type="email" placeholder="Email">
ย ย ย ย ย ย ย ย <input id="reg-pass" class="input" type="password" placeholder="Contraseรฑa">
ย ย ย ย ย ย ย ย <label class="text-accent" style="font-weight:bold; font-size:0.75rem; margin-left:5px;">CรDIGO SECRETO</label>
ย ย ย ย ย ย ย ย <input id="reg-code" class="input" style="text-align:center; border-color:var(--accent); letter-spacing:4px; font-weight:bold;">
ย ย ย ย ย ย ย ย <button onclick="doRegister()" class="btn btn-primary">SOLICITAR ACCESO</button>
ย ย ย ย ย ย ย ย <button onclick="toLogin()" class="btn btn-secondary">Cancelar</button>
ย ย ย ย ย ย </div>
ย ย ย ย </div>
ย ย </div>

ย ย <div id="app" class="screen">
ย ย ย ยย
ย ย ย ย <div id="view-home" class="view">
ย ย ย ย ย ย <div class="navbar-top">
ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย <h2 id="u-name" style="margin:0; font-size:1.5rem;">Hola</h2>
ย ย ย ย ย ย ย ย ย ย <span id="u-goal" style="color:var(--muted); font-size:0.75rem; text-transform:uppercase;">Cargando...</span>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย <button id="admin-btn" onclick="nav('view-admin')" class="btn-icon hidden">๐</button>
ย ย ย ย ย ย </div>

ย ย ย ย ย ย <div class="container">
ย ย ย ย ย ย ย ย <div id="stagnation-alert" class="card hidden" style="background:rgba(255,170,0,0.1); border-color:var(--warning); padding:12px;">
ย ย ย ย ย ย ย ย ย ย โ๏ธ <strong style="color:var(--warning)">Alerta Coach:</strong> Sin actividad > 14 dรญas.
ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย <div id="nutrition-panel" class="card hidden" style="border-left-color:var(--success);">
ย ย ย ย ย ย ย ย ย ย <h3>Objetivo Diario</h3>
ย ย ย ย ย ย ย ย ย ย <div style="display:flex; gap:10px; margin-top:10px;">
ย ย ย ย ย ย ย ย ย ย ย ย <div style="flex:1; background:#222; padding:10px; border-radius:10px; text-align:center;">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span style="font-size:1.5rem;">๐ฅ</span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div id="target-kcal" style="font-weight:bold; font-size:1.2rem; color:white;">-</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <small class="text-muted">Kcal</small>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย <div style="flex:1; background:#222; padding:10px; border-radius:10px; text-align:center;">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span style="font-size:1.5rem;">๐ง</span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div id="target-water" style="font-weight:bold; font-size:1.2rem; color:white;">-</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <small class="text-muted">Litros</small>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div style="margin-top:15px; border-top:1px solid #333; padding-top:10px;">
ย ย ย ย ย ย ย ย ย ย ย ย <small class="text-muted">Registro de hoy:</small>
ย ย ย ย ย ย ย ย ย ย ย ย <div style="display:flex; gap:10px; margin-top:5px;">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <input id="user-kcal" type="number" class="input" placeholder="Ingerido (Kcal)" style="margin:0;">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <input id="user-water" type="number" class="input" placeholder="Bebido (L)" style="margin:0;">
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย <button onclick="saveDailyNutrition()" class="btn btn-secondary" style="margin-top:10px; width:100%;">Guardar Registro</button>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย <div style="display:flex; gap:10px; margin-bottom:20px;">
ย ย ย ย ย ย ย ย ย ย <button onclick="openRoutineModal()" class="btn btn-primary" style="margin:0; flex:2;">+ Crear Rutina</button>
ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย <h3 class="text-accent" style="border-bottom:1px solid #333; margin-bottom:15px; padding-bottom:5px; font-size:1rem; text-transform:uppercase;">Mis Rutinas</h3>
ย ย ย ย ย ย ย ย <div id="routines-list"></div>
ย ย ย ย ย ย </div>
ย ย ย ย </div>

ย ย ย ย <div id="view-profile" class="view hidden">
ย ย ย ย ย ย <div class="navbar-top"><h2>Rendimiento</h2></div>
ย ย ย ย ย ย <div class="container">
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย <div class="card" style="text-align:center; overflow-x: auto;">
ย ย ย ย ย ย ย ย ย ย <h3>Mapa de Trabajo</h3>
ย ย ย ย ย ย ย ย ย ย <p class="text-muted" style="font-size:0.8rem;">Intensidad acumulada</p>
ย ย ย ย ย ย ย ย ย ย <div id="heatmap-render" class="heatmap-wrapper"></div>
ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย <div class="stats-grid">
ย ย ย ย ย ย ย ย ย ย <div class="stat-box"><span id="stat-kg" class="stat-val">0</span><span class="stat-lbl">TONELADAS</span></div>
ย ย ย ย ย ย ย ย ย ย <div class="stat-box"><span id="stat-workouts" class="stat-val">0</span><span class="stat-lbl">ENTRENOS</span></div>
ย ย ย ย ย ย ย ย ย ย <div class="stat-box"><span id="stat-sets" class="stat-val">0</span><span class="stat-lbl">SERIES</span></div>
ย ย ย ย ย ย ย ย ย ย <div class="stat-box"><span id="stat-reps" class="stat-val">0</span><span class="stat-lbl">REPS</span></div>
ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย <div class="card">
ย ย ย ย ย ย ย ย ย ย <h3>Evoluciรณn Peso</h3>
ย ย ย ย ย ย ย ย ย ย <canvas id="weightChart" style="max-height:180px; margin-bottom:15px;"></canvas>
ย ย ย ย ย ย ย ย ย ย <div style="display:flex; gap:10px;">
ย ย ย ย ย ย ย ย ย ย ย ย <input id="new-weight" type="number" class="input" placeholder="Peso actual (kg)" style="margin:0;">
ย ย ย ย ย ย ย ย ย ย ย ย <button onclick="saveWeight()" class="btn btn-primary" style="width:auto; margin:0;">Registrar</button>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย <div class="card">
ย ย ย ย ย ย ย ย ย ย <div style="display:flex; justify-content:space-between; align-items:center;">
ย ย ย ย ย ย ย ย ย ย ย ย <h3>Check Fรญsico</h3>
ย ย ย ย ย ย ย ย ย ย ย ย <label class="btn btn-secondary" style="width:auto; padding:6px 12px; font-size:0.8rem;">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ๐ท Subir <input type="file" id="photo-in" accept="image/*" hidden onchange="uploadPhoto(this)">
ย ย ย ย ย ย ย ย ย ย ย ย </label>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <p class="text-muted" style="margin:10px 0; font-size:0.8rem; background:#222; padding:8px; border-radius:6px;">๐ก Usa siempre la misma luz, misma ropa y mismo รกngulo.</p>
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย <div style="display:flex; gap:5px; margin-bottom:15px;">
ย ย ย ย ย ย ย ย ย ย ย ย <div id="comp-before" style="flex:1; aspect-ratio:3/4; border:1px dashed #444; border-radius:8px; display:flex; align-items:center; justify-content:center; overflow:hidden;"><small>Inicio</small></div>
ย ย ย ย ย ย ย ย ย ย ย ย <div id="comp-now" style="flex:1; aspect-ratio:3/4; border:1px dashed #444; border-radius:8px; display:flex; align-items:center; justify-content:center; overflow:hidden;"><small>Actual</small></div>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div id="gallery" style="display:grid; grid-template-columns:1fr 1fr; gap:10px;"></div>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย </div>
ย ย ย ย </div>

ย ย ย ย <div id="view-config" class="view hidden">
ย ย ย ย ย ย <div class="navbar-top"><h2>Ajustes</h2></div>
ย ย ย ย ย ย <div class="container">
ย ย ย ย ย ย ย ย <div class="card">
ย ย ย ย ย ย ย ย ย ย <h3>Etapa Actual</h3>
ย ย ย ย ย ย ย ย ย ย <select id="cfg-goal" class="input" onchange="saveConfig()">
ย ย ย ย ย ย ย ย ย ย ย ย <option value="Definiciรณn">Definiciรณn (Dรฉficit)</option>
ย ย ย ย ย ย ย ย ย ย ย ย <option value="Mantenimiento">Mantenimiento</option>
ย ย ย ย ย ย ย ย ย ย ย ย <option value="Volumen">Volumen (Superรกvit)</option>
ย ย ย ย ย ย ย ย ย ย </select>

ย ย ย ย ย ย ย ย ย ย <h3>Avisos</h3>
ย ย ย ย ย ย ย ย ย ย <div class="toggle-row">
ย ย ย ย ย ย ย ย ย ย ย ย <span>Recordatorio Fotos</span>
ย ย ย ย ย ย ย ย ย ย ย ย <div style="display:flex; gap:5px;">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <select id="cfg-alarm-day" class="input" style="width:auto; margin:0;" onchange="saveConfig()">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="-1">Off</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="1">Lun</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="2">Mar</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="3">Miรฉ</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="4">Jue</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="5">Vie</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="6">Sรกb</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="0">Dom</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </select>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <input type="time" id="cfg-alarm-time" class="input" style="width:auto; margin:0;" onchange="saveConfig()">
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย ย ย <h3>Sistema</h3>
ย ย ย ย ย ย ย ย ย ย <div style="margin-top:15px;">
ย ย ย ย ย ย ย ย ย ย ย ย <label style="color:var(--muted); font-size:0.9rem;">Tiempo Descanso (seg)</label>
ย ย ย ย ย ย ย ย ย ย ย ย <input id="cfg-rest" type="number" class="input" value="60" onchange="saveConfig()">
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย <div class="toggle-row">
ย ย ย ย ย ย ย ย ย ย ย ย <span>Sonido Alarma</span>
ย ย ย ย ย ย ย ย ย ย ย ย <label class="switch"><input type="checkbox" id="cfg-sound" onchange="saveConfig()"><span class="slider"></span></label>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div class="toggle-row">
ย ย ย ย ย ย ย ย ย ย ย ย <span>Pantalla Encendida</span>
ย ย ย ย ย ย ย ย ย ย ย ย <label class="switch"><input type="checkbox" id="cfg-screen" onchange="saveConfig()"><span class="slider"></span></label>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย <button onclick="auth.signOut()" class="btn btn-secondary">Cerrar Sesiรณn</button>
ย ย ย ย ย ย </div>
ย ย ย ย </div>

ย ย ย ย <div id="view-admin" class="view hidden">
ย ย ย ย ย ย <div class="navbar-top">
ย ย ย ย ย ย ย ย <h2>Panel Coach</h2>
ย ย ย ย ย ย ย ย <button onclick="nav('view-home')" class="btn btn-secondary" style="width:auto; padding:5px 10px;">Volver</button>
ย ย ย ย ย ย </div>
ย ย ย ย ย ย <div class="container">
ย ย ย ย ย ย ย ย <div class="card">
ย ย ย ย ย ย ย ย ย ย <h3>Solicitudes (<span id="count-pending">0</span>)</h3>
ย ย ย ย ย ย ย ย ย ย <div id="adm-pending"></div>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย <h3>Atletas Activos</h3>
ย ย ย ย ย ย ย ย <div id="adm-users"></div>
ย ย ย ย ย ย </div>
ย ย ย ย </div>

ย ย ย ย <div class="nav-bottom">
ย ย ย ย ย ย <button class="nav-item active" onclick="nav('view-home')"><i>๐๏ธ</i>Rutinas</button>
ย ย ย ย ย ย <button class="nav-item" onclick="nav('view-profile')"><i>๐</i>Perfil</button>
ย ย ย ย ย ย <button class="nav-item" onclick="nav('view-config')"><i>โ๏ธ</i>Ajustes</button>
ย ย ย ย </div>
ย ย </div>

ย ย <div id="workout-ui" class="screen" style="z-index:1500; position:fixed; top:0; left:0; width:100%; height:100%; background:var(--bg); overflow-y:auto; padding-bottom:100px;">
ย ย ย ย <div class="navbar-top">
ย ย ย ย ย ย <button onclick="exitWorkout()" style="width:auto; background:none; border:none; color:white; font-size:1.5rem;">โ</button>
ย ย ย ย ย ย <div id="wo-title" style="font-weight:bold; color:var(--accent);">Rutina</div>
ย ย ย ย ย ย <div id="wo-timer" style="font-family:monospace; border:1px solid var(--accent); padding:2px 8px; border-radius:6px; color:var(--accent);">00:00</div>
ย ย ย ย </div>
ย ย ย ย <div id="wo-container" class="container"></div>
ย ย ย ย <div style="position:fixed; bottom:0; left:0; width:100%; background:rgba(0,0,0,0.9); padding:15px; border-top:1px solid #333; padding-bottom:calc(15px + var(--safe-bottom));">
ย ย ย ย ย ย <button onclick="finishPrompt()" class="btn btn-success" style="margin:0;">FINALIZAR ENTRENAMIENTO</button>
ย ย ย ย </div>
ย ย ย ย <div id="float-timer" class="timer-float hidden">
ย ย ย ย ย ย <span id="timer-val" onclick="stopRest()">60</span>
ย ย ย ย ย ย <div onclick="addTime()" style="font-size:0.6rem; position:absolute; bottom:-15px; background:#333; padding:2px 5px; border-radius:4px; color:white;">+30s</div>
ย ย ย ย </div>
ย ย </div>

ย ย <div id="modal-athlete" class="modal hidden">
ย ย ย ย <div class="modal-content">
ย ย ย ย ย ย <div style="display:flex; justify-content:space-between;">
ย ย ย ย ย ย ย ย <h2 id="adm-ath-name">Atleta</h2>
ย ย ย ย ย ย ย ย <button onclick="closeAdminModal()" class="btn-secondary" style="width:auto; padding:5px 10px;">X</button>
ย ย ย ย ย ย </div>
ย ย ย ย ย ยย
ย ย ย ย ย ย <div class="card">
ย ย ย ย ย ย ย ย <h3>Asignar Objetivos</h3>
ย ย ย ย ย ย ย ย <div style="display:flex; gap:10px;">
ย ย ย ย ย ย ย ย ย ย <div><small>Kcal Objetivo</small><input id="adm-set-kcal" type="number" class="input"></div>
ย ย ย ย ย ย ย ย ย ย <div><small>Agua (L) Objetivo</small><input id="adm-set-water" type="number" class="input"></div>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย <button onclick="adminSaveTargets()" class="btn btn-primary">Guardar Objetivos</button>
ย ย ย ย ย ย </div>

ย ย ย ย ย ย <div class="card">
ย ย ย ย ย ย ย ย <h3>Datos & Stats</h3>
ย ย ย ย ย ย ย ย <p>Edad: <span id="adm-ath-age">-</span> | Altura: <span id="adm-ath-height">-</span></p>
ย ย ย ย ย ย ย ย <div class="stats-grid" style="margin-top:10px;">
ย ย ย ย ย ย ย ย ย ย <div class="stat-box"><span id="adm-ath-kg" class="stat-val">0</span><small>KG</small></div>
ย ย ย ย ย ย ย ย ย ย <div class="stat-box"><span id="adm-ath-sets" class="stat-val">0</span><small>SERIES</small></div>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย </div>

ย ย ย ย ย ย <div class="card">
ย ย ย ย ย ย ย ย <h3>Grรกfica Peso</h3>
ย ย ย ย ย ย ย ย <canvas id="adminWeightChart" style="max-height:150px;"></canvas>
ย ย ย ย ย ย </div>

ย ย ย ย ย ย <h3>Fotos Recientes</h3>
ย ย ย ย ย ย <div id="admin-gallery" style="display:grid; grid-template-columns:1fr 1fr; gap:5px;"></div>
ย ย ย ย </div>
ย ย </div>

ย ย <div id="modal-alert" class="modal hidden">
ย ย ย ย <div class="modal-content">
ย ย ย ย ย ย <h3>Enviar Alerta</h3>
ย ย ย ย ย ย <input id="alert-msg" class="input" placeholder="Escribe el mensaje...">
ย ย ย ย ย ย <button onclick="sendAdminAlert()" class="btn btn-primary">Enviar</button>
ย ย ย ย ย ย <button onclick="document.getElementById('modal-alert').classList.add('hidden')" class="btn btn-secondary">Cancelar</button>
ย ย ย ย </div>
ย ย </div>

ย ย <div id="modal-create" class="modal hidden">
ย ย ย ย <div class="modal-content">
ย ย ย ย ย ย <h3 id="modal-routine-title">Nueva Rutina</h3>
ย ย ย ย ย ย <p id="routine-target-msg" class="text-muted hidden">Asignando a: <span id="target-user-name"></span></p>
ย ย ย ย ย ยย
ย ย ย ย ย ย <input id="new-rout-name" class="input" placeholder="Nombre (Ej: Pierna A)">
ย ย ย ย ย ย <input id="search-ex" class="input" placeholder="๐ Buscar..." onkeyup="renderExSelector()">
ย ย ย ย ย ย <div id="ex-list" style="max-height:300px; overflow-y:auto; margin-bottom:15px; border:1px solid #333; border-radius:8px; padding:5px;"></div>
ย ย ย ย ย ย <div style="display:flex; gap:10px;">
ย ย ย ย ย ย ย ย <button onclick="saveRoutine()" class="btn btn-primary">Guardar</button>
ย ย ย ย ย ย ย ย <button onclick="document.getElementById('modal-create').classList.add('hidden')" class="btn btn-secondary">Cancelar</button>
ย ย ย ย ย ย </div>
ย ย ย ย </div>
ย ย </div>

ย ย <div id="modal-rpe" class="modal hidden">
ย ย ย ย <div class="modal-content" style="text-align:center;">
ย ย ย ย ย ย <h3>Intensidad (RPE)</h3>
ย ย ย ย ย ย <div style="display:grid; gap:10px; margin-top:20px;">
ย ย ย ย ย ย ย ย <button onclick="saveWorkoutLog(1)" class="btn" style="background:#22dd88; color:black;">RPE 1-4 (Fรกcil)</button>
ย ย ย ย ย ย ย ย <button onclick="saveWorkoutLog(2)" class="btn" style="background:#ffaa00; color:black;">RPE 5-7 (Medio)</button>
ย ย ย ย ย ย ย ย <button onclick="saveWorkoutLog(3)" class="btn" style="background:#ff4444; color:white;">RPE 8-10 (Fallo)</button>
ย ย ย ย ย ย </div>
ย ย ย ย </div>
ย ย </div>

ย ย <div id="modal-note" class="modal hidden">
ย ย ย ย <div class="modal-content">
ย ย ย ย ย ย <h3>Nota del Ejercicio</h3>
ย ย ย ย ย ย <textarea id="note-text" class="input" rows="4" placeholder="Ej: Sillรญn al 6..."></textarea>
ย ย ย ย ย ย <div style="display:flex; gap:10px;">
ย ย ย ย ย ย ย ย <button onclick="saveNote()" class="btn btn-primary">Guardar</button>
ย ย ย ย ย ย ย ย <button onclick="document.getElementById('modal-note').classList.add('hidden')" class="btn btn-secondary">Cancelar</button>
ย ย ย ย ย ย </div>
ย ย ย ย </div>
ย ย </div>

ย ย <audio id="beep" src="data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU"></audio>

ย ย <script>
ย ย ย ย // --- 1. FIREBASE CONFIG (PON TUS CLAVES AQUร) ---
ย ย ย ย const firebaseConfig = {
ย ย ย ย ย ย apiKey: "AIzaSyCmM0gViU3itZ4HIZZVTEm7OaV0iBtsiGs",
ย ย ย ย ย ย authDomain: "fitdata-7a86b.firebaseapp.com",
ย ย ย ย ย ย projectId: "fitdata-7a86b",
ย ย ย ย ย ย storageBucket: "fitdata-7a86b.firebasestorage.app",
ย ย ย ย ย ย messagingSenderId: "949628013924",
ย ย ย ย ย ย appId: "1:949628013924:web:86278ae2c2bafb384d7e71"
ย ย ย ย };
ย ย ย ย firebase.initializeApp(firebaseConfig);
ย ย ย ย const auth = firebase.auth();
ย ย ย ย const db = firebase.firestore();

ย ย ย ย // --- 2. CONSTANTES ---
ย ย ย ย const ADMIN_EMAIL = "toni@fitdata.com";
ย ย ย ย const SECRET_CODE = "fityhab";
ย ย ย ยย
ย ย ย ย let currentUser = null;
ย ย ย ย let userData = null;
ย ย ย ย let selectedExs = [];
ย ย ย ย let activeRoutine = null;
ย ย ย ย let woStartTime = null;
ย ย ย ย let woTimerInt = null;
ย ย ย ย let restTimerInt = null;
ย ย ย ย let wakeLock = null;
ย ย ย ย let weightChart = null;
ย ย ย ย let adminWeightChart = null;
ย ย ย ย let currentAdminUser = null;
ย ย ย ย let adminAssignTarget = null;
ย ย ย ย let currentNoteExId = null;
ย ย ย ย let editingRoutineId = null;

ย ย ย ย // --- 3. GESTIรN IMรGENES (LOCALES) ---
ย ย ย ย function getMuscleImg(muscle) {
ย ย ย ย ย ย const m = muscle.toLowerCase();
ย ย ย ย ย ย if (m.includes('pecho')) return 'pecho.jpg';
ย ย ย ย ย ย if (m.includes('espalda')) return 'espalda.jpg';
ย ย ย ย ย ย if (m.includes('pierna') || m.includes('femoral')) return 'piernas.jpg';
ย ย ย ย ย ย if (m.includes('hombro')) return 'hombros.jpg';
ย ย ย ย ย ย if (m.includes('biceps') || m.includes('bรญceps')) return 'biceps.jpg';
ย ย ย ย ย ย if (m.includes('triceps') || m.includes('trรญceps')) return 'triceps.jpg';
ย ย ย ย ย ย if (m.includes('abs')) return 'abs.jpg';
ย ย ย ย ย ย if (m.includes('glute') || m.includes('glรบteo')) return 'gluteos.jpg';
ย ย ย ย ย ย return 'logo.png';ย
ย ย ย ย }

ย ย ย ย // GENERADOR DE MAPA DE CALOR REALISTA (FRENTE Y ESPALDA)
ย ย ย ย function renderHeatmap(stats) {
ย ย ย ย ย ย const container = document.getElementById('heatmap-render');
ย ย ย ย ย ย if (!container) return;
ย ย ย ย ย ย const getOp = (key) => Math.min(0.2 + ((stats[key]||0) / 50), 1);
ย ย ย ย ย ยย
ย ย ย ย ย ย // DIBUJOS ANATรMICOS SIMPLIFICADOS EN SVG (FRENTE Y ESPALDA)
ย ย ย ย ย ย container.innerHTML = `
ย ย ย ย ย ย <svg viewBox="0 0 200 120" class="body-svg">
ย ย ย ย ย ย ย ย <g transform="translate(0,0)">
ย ย ย ย ย ย ย ย ย ย <path d="M50,5 C55,5 60,10 60,15 L65,18 L70,35 L60,60 L62,80 L65,115 L55,115 L52,85 L48,85 L45,115 L35,115 L38,80 L40,60 L30,35 L35,18 L40,15 C40,10 45,5 50,5" fill="#222" />
ย ย ย ย ย ย ย ย ย ย <path d="M38,22 L62,22 L60,35 L40,35 Z" fill="#ff4444" fill-opacity="${getOp('Pecho')}"/>
ย ย ย ย ย ย ย ย ย ย <rect x="42" y="38" width="16" height="25" fill="#ff4444" fill-opacity="${getOp('Abs')}"/>
ย ย ย ย ย ย ย ย ย ย <path d="M30,35 L20,60 L35,60 Z" fill="#ff4444" fill-opacity="${getOp('Bรญceps')}"/>
ย ย ย ย ย ย ย ย ย ย <path d="M70,35 L80,60 L65,60 Z" fill="#ff4444" fill-opacity="${getOp('Bรญceps')}"/>
ย ย ย ย ย ย ย ย ย ย <path d="M40,65 L35,95 L48,95 L48,65 Z" fill="#ff4444" fill-opacity="${getOp('Piernas')}"/>
ย ย ย ย ย ย ย ย ย ย <path d="M60,65 L65,95 L52,95 L52,65 Z" fill="#ff4444" fill-opacity="${getOp('Piernas')}"/>
ย ย ย ย ย ย ย ย </g>

ย ย ย ย ย ย ย ย <g transform="translate(100,0)">
ย ย ย ย ย ย ย ย ย ย <path d="M50,5 C55,5 60,10 60,15 L68,18 L75,35 L65,60 L62,80 L65,115 L55,115 L52,85 L48,85 L45,115 L35,115 L38,80 L35,60 L25,35 L32,18 L40,15 C40,10 45,5 50,5" fill="#222" />
ย ย ย ย ย ย ย ย ย ย <path d="M35,20 L65,20 L58,50 L42,50 Z" fill="#ff4444" fill-opacity="${getOp('Espalda')}"/>
ย ย ย ย ย ย ย ย ย ย <path d="M25,35 L20,55 L32,55 Z" fill="#ff4444" fill-opacity="${getOp('Trรญceps')}"/>
ย ย ย ย ย ย ย ย ย ย <path d="M75,35 L80,55 L68,55 Z" fill="#ff4444" fill-opacity="${getOp('Trรญceps')}"/>
ย ย ย ย ย ย ย ย ย ย <circle cx="42" cy="65" r="7" fill="#ff4444" fill-opacity="${getOp('Piernas')}"/>
ย ย ย ย ย ย ย ย ย ย <circle cx="58" cy="65" r="7" fill="#ff4444" fill-opacity="${getOp('Piernas')}"/>
ย ย ย ย ย ย ย ย ย ย <rect x="38" y="75" width="8" height="15" fill="#ff4444" fill-opacity="${getOp('Piernas')}"/>
ย ย ย ย ย ย ย ย ย ย <rect x="54" y="75" width="8" height="15" fill="#ff4444" fill-opacity="${getOp('Piernas')}"/>
ย ย ย ย ย ย ย ย </g>
ย ย ย ย ย ย </svg>`;
ย ย ย ย }

ย ย ย ย // 4. BASE DE DATOS COMPLETA
ย ย ย ย const rawExercisesDB = [
ย ย ย ย ย ย { id: 1, name: 'Sentadilla con Barra', muscle: 'Piernas', emoji: '๐๏ธ' },
ย ย ย ย ย ย { id: 2, name: 'Sentadilla Jaca', muscle: 'Piernas', emoji: 'โ๏ธ' },
ย ย ย ย ย ย { id: 3, name: 'Sentadilla con Cinturรณn', muscle: 'Piernas', emoji: '๐๏ธ' },
ย ย ย ย ย ย { id: 4, name: 'Prensa de Piernas', muscle: 'Piernas', emoji: 'โ๏ธ' },
ย ย ย ย ย ย { id: 5, name: 'Extensiรณn de Cuรกdriceps', muscle: 'Piernas', emoji: 'โ๏ธ' },
ย ย ย ย ย ย { id: 6, name: 'Estocadas con Mancuernas', muscle: 'Piernas', emoji: '๐๏ธ' },
ย ย ย ย ย ย { id: 7, name: 'Curl de Pierna Tumbado', muscle: 'Piernas', emoji: 'โ๏ธ' },
ย ย ย ย ย ย { id: 8, name: 'Curl de Pierna Sentado', muscle: 'Piernas', emoji: 'โ๏ธ' },
ย ย ย ย ย ย { id: 9, name: 'Prensa Horizontal', muscle: 'Piernas', emoji: 'โ๏ธ' },
ย ย ย ย ย ย { id: 10, name: 'Prensa de piernas 45ยฐ', muscle: 'Piernas', emoji: 'โ๏ธ' },
ย ย ย ย ย ย { id: 11, name: 'Elevaciรณn de Talones Sentado', muscle: 'Piernas', emoji: 'โ๏ธ' },
ย ย ย ย ย ย { id: 12, name: 'Elevaciรณn de Talones de Pie', muscle: 'Piernas', emoji: '๐๏ธ' },
ย ย ย ย ย ย { id: 13, name: 'Elevaciรณn de Talones en Mรกquina', muscle: 'Piernas', emoji: 'โ๏ธ' },
ย ย ย ย ย ย { id: 14, name: 'Elevaciรณn de Cadera', muscle: 'Piernas', emoji: '๐๏ธ' },
ย ย ย ย ย ย { id: 15, name: 'Sentadilla Bรบlgara', muscle: 'Piernas', emoji: '๐๏ธ' },
ย ย ย ย ย ย { id: 16, name: 'Patada de Glรบteo en Polea', muscle: 'Piernas', emoji: '๐' },
ย ย ย ย ย ย { id: 17, name: 'Abducciรณn de Cadera en Mรกquina', muscle: 'Piernas', emoji: 'โ๏ธ' },
ย ย ย ย ย ย { id: 18, name: 'Prensa de Glรบteos', muscle: 'Piernas', emoji: 'โ๏ธ' },
ย ย ย ย ย ย { id: 19, name: 'Peso Muerto', muscle: 'Espalda', emoji: '๐๏ธ' },
ย ย ย ย ย ย { id: 20, name: 'Peso Muerto Rumano', muscle: 'Piernas', emoji: '๐๏ธ' },
ย ย ย ย ย ย { id: 21, name: 'Peso Muerto Sumo', muscle: 'Espalda', emoji: '๐๏ธ' },
ย ย ย ย ย ย { id: 22, name: 'Remo con Barra', muscle: 'Espalda', emoji: '๐๏ธ' },
ย ย ย ย ย ย { id: 23, name: 'Remo con Mancuernas', muscle: 'Espalda', emoji: '๐๏ธ' },
ย ย ย ย ย ย { id: 24, name: 'Jalรณn Lateral', muscle: 'Espalda', emoji: '๐' },
ย ย ย ย ย ย { id: 25, name: 'Jalรณn Lateral Cerrado', muscle: 'Espalda', emoji: '๐' },
ย ย ย ย ย ย { id: 26, name: 'Remo en Mรกquina', muscle: 'Espalda', emoji: 'โ๏ธ' },
ย ย ย ย ย ย { id: 27, name: 'Remo en Polea Baja', muscle: 'Espalda', emoji: '๐' },
ย ย ย ย ย ย { id: 28, name: 'Dominadas', muscle: 'Espalda', emoji: '๐คธ' },
ย ย ย ย ย ย { id: 29, name: 'Dominadas Asistidas', muscle: 'Espalda', emoji: 'โ๏ธ' },
ย ย ย ย ย ย { id: 30, name: 'Remo Invertido', muscle: 'Espalda', emoji: '๐คธ' },
ย ย ย ย ย ย { id: 31, name: 'Remo T', muscle: 'Espalda', emoji: '๐๏ธ' },
ย ย ย ย ย ย { id: 32, name: 'Hiperextensiรณn', muscle: 'Espalda', emoji: 'โ๏ธ' },
ย ย ย ย ย ย { id: 33, name: 'Buenos Dรญas', muscle: 'Espalda', emoji: '๐๏ธ' },
ย ย ย ย ย ย { id: 34, name: 'Press de Banca', muscle: 'Pecho', emoji: '๐๏ธ' },
ย ย ย ย ย ย { id: 35, name: 'Press Inclinado con Mancuernas', muscle: 'Pecho', emoji: '๐๏ธ' },
ย ย ย ย ย ย { id: 36, name: 'Aperturas con Mancuernas', muscle: 'Pecho', emoji: '๐ฆ' },
ย ย ย ย ย ย { id: 37, name: 'Cruces en Polea', muscle: 'Pecho', emoji: '๐' },
ย ย ย ย ย ย { id: 38, name: 'Prensa de Pecho en Mรกquina', muscle: 'Pecho', emoji: 'โ๏ธ' },
ย ย ย ย ย ย { id: 39, name: 'Prensa de Pecho Declinado', muscle: 'Pecho', emoji: '๐๏ธ' },
ย ย ย ย ย ย { id: 40, name: 'Fondos en Paralelas', muscle: 'Pecho', emoji: '๐คธ' },
ย ย ย ย ย ย { id: 41, name: 'Encogimiento de Hombros', muscle: 'Hombros', emoji: '๐๏ธ' },
ย ย ย ย ย ย { id: 42, name: 'Encogimiento con Mancuernas', muscle: 'Hombros', emoji: '๐๏ธ' },
ย ย ย ย ย ย { id: 43, name: 'Press Militar', muscle: 'Hombros', emoji: '๐๏ธ' },
ย ย ย ย ย ย { id: 44, name: 'Press de Hombros con Mancuernas', muscle: 'Hombros', emoji: '๐๏ธ' },
ย ย ย ย ย ย { id: 45, name: 'Press de Hombros en Mรกquina', muscle: 'Hombros', emoji: 'โ๏ธ' },
ย ย ย ย ย ย { id: 46, name: 'Elevaciรณn Lateral', muscle: 'Hombros', emoji: '๐๏ธ' },
ย ย ย ย ย ย { id: 47, name: 'Elevaciรณn Frontal', muscle: 'Hombros', emoji: '๐๏ธ' },
ย ย ย ย ย ย { id: 48, name: 'Pรกjaros Inversos', muscle: 'Hombros', emoji: '๐ฆ' },
ย ย ย ย ย ย { id: 49, name: 'Elevaciรณn Lateral en Polea', muscle: 'Hombros', emoji: '๐' },
ย ย ย ย ย ย { id: 50, name: 'Press Arnold', muscle: 'Hombros', emoji: '๐๏ธ' },
ย ย ย ย ย ย { id: 51, name: 'Curl de Barra', muscle: 'Biceps', emoji: '๐ช' },
ย ย ย ย ย ย { id: 52, name: 'Curl de Mancuernas', muscle: 'Biceps', emoji: '๐ช' },
ย ย ย ย ย ย { id: 53, name: 'Curl en Polea', muscle: 'Biceps', emoji: '๐' },
ย ย ย ย ย ย { id: 54, name: 'Curl Martillo', muscle: 'Biceps', emoji: '๐ช' },
ย ย ย ย ย ย { id: 55, name: 'Curl Concentrado', muscle: 'Biceps', emoji: '๐ช' },
ย ย ย ย ย ย { id: 56, name: 'Extensiรณn de Trรญceps en Polea', muscle: 'Triceps', emoji: '๐' },
ย ย ย ย ย ย { id: 57, name: 'Extensiรณn Francesa', muscle: 'Triceps', emoji: '๐๏ธ' },
ย ย ย ย ย ย { id: 58, name: 'Extensiones Acostadas', muscle: 'Triceps', emoji: '๐๏ธ' },
ย ย ย ย ย ย { id: 59, name: 'Fondos en Paralelas', muscle: 'Triceps', emoji: '๐คธ' },
ย ย ย ย ย ย { id: 60, name: 'Extensiรณn Unilateral Trรญceps', muscle: 'Triceps', emoji: '๐ช' },
ย ย ย ย ย ย { id: 61, name: 'Abdominales con Rueda', muscle: 'Abs', emoji: 'โญ' },
ย ย ย ย ย ย { id: 62, name: 'Crunch en Polea', muscle: 'Abs', emoji: '๐' },
ย ย ย ย ย ย { id: 63, name: 'Elevaciones de Pierna Colgadas', muscle: 'Abs', emoji: '๐คธ' },
ย ย ย ย ย ย { id: 64, name: 'Abdominales en Banco', muscle: 'Abs', emoji: '๐๏ธ' },
ย ย ย ย ย ย { id: 65, name: 'Crunch en Mรกquina', muscle: 'Abs', emoji: 'โ๏ธ' },
ย ย ย ย ย ย { id: 66, name: 'Levantamiento de Rodillas Colgado', muscle: 'Abs', emoji: '๐คธ' },
ย ย ย ย ย ย { id: 67, name: 'Aperturas de Pecho', muscle: 'Pecho', emoji: '๐ฆ' },
ย ย ย ย ย ย { id: 68, name: 'Press Inclinado', muscle: 'Pecho', emoji: '๐๏ธ' },
ย ย ย ย ย ย { id: 69, name: 'Press Plano', muscle: 'Pecho', emoji: '๐๏ธ' },
ย ย ย ย ย ย { id: 70, name: 'Prensa Lateral Iso', muscle: 'Pecho', emoji: 'โ๏ธ' },
ย ย ย ย ย ย { id: 71, name: 'Prensa de Pecho', muscle: 'Pecho', emoji: 'โ๏ธ' },
ย ย ย ย ย ย { id: 72, name: 'Triceps Polea', muscle: 'Triceps', emoji: '๐' },
ย ย ย ย ย ย { id: 73, name: 'Triceps Barra', muscle: 'Triceps', emoji: '๐๏ธ' },
ย ย ย ย ย ย { id: 74, name: 'Remo Hammer', muscle: 'Espalda', emoji: 'โ๏ธ' },
ย ย ย ย ย ย { id: 75, name: 'Jalรณn Agarre Cerrado', muscle: 'Espalda', emoji: '๐' },
ย ย ย ย ย ย { id: 76, name: 'Jalรณn Agarre Abierto', muscle: 'Espalda', emoji: '๐' },
ย ย ย ย ย ย { id: 77, name: 'Remo alto', muscle: 'Espalda', emoji: 'โ๏ธ' },
ย ย ย ย ย ย { id: 78, name: 'Press de Hombros', muscle: 'Hombros', emoji: '๐๏ธ' },
ย ย ย ย ย ย { id: 79, name: 'Face Pull', muscle: 'Hombros', emoji: '๐' },
ย ย ย ย ย ย { id: 80, name: 'Curl Predicador', muscle: 'Biceps', emoji: '๐ช' },
ย ย ย ย ย ย { id: 81, name: 'Curl Concentrado', muscle: 'Biceps', emoji: '๐ช' },
ย ย ย ย ย ย { id: 82, name: 'Prensa 45ยฐ', muscle: 'Piernas', emoji: 'โ๏ธ' },
ย ย ย ย ];

ย ย ย ย const exercisesDB = rawExercisesDB.map(ex => ({
ย ย ย ย ย ย ...ex,
ย ย ย ย ย ย image: getMuscleImg(ex.muscle)
ย ย ย ย }));

ย ย ย ย function showToast(msg) { const t=document.getElementById("toast"); t.innerText=msg; t.className="show"; setTimeout(()=>t.className="",3000); }

ย ย ย ย // 5. AUTH & LOGIC
ย ย ย ย auth.onAuthStateChanged(async u => {
ย ย ย ย ย ย if(u) {
ย ย ย ย ย ย ย ย db.collection('users').doc(u.uid).onSnapshot(doc => {
ย ย ย ย ย ย ย ย ย ย if(doc.exists) {
ย ย ย ย ย ย ย ย ย ย ย ย userData = doc.data();
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย // Check alarmas al inicio
ย ย ย ย ย ย ย ย ย ย ย ย checkAlarms();
ย ย ย ย ย ย ย ย ย ย ย ย // Check notificaciones admin
ย ย ย ย ย ย ย ย ย ย ย ย checkAdminAlerts();

ย ย ย ย ย ย ย ย ย ย ย ย if(userData.email.toLowerCase() === ADMIN_EMAIL) {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย listenToAllUsers();
ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย if(userData.approved || userData.email.toLowerCase() === ADMIN_EMAIL) {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย currentUser = u;
ย ย ย ย ย ย ย ย ย ย ย ย ย ย setTimeout(() => {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย document.getElementById('loading').classList.remove('active');
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย initApp();
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย loadWorkoutFromStorage();ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย }, 2000);
ย ย ย ย ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย document.getElementById('loading').classList.remove('active');
ย ย ย ย ย ย ย ย ย ย ย ย ย ย showToast("Pendiente de Aprobaciรณn"); showScreen('login');
ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย } else {ย
ย ย ย ย ย ย ย ย document.getElementById('loading').classList.remove('active');
ย ย ย ย ย ย ย ย showScreen('login');ย
ย ย ย ย ย ย }
ย ย ย ย });

ย ย ย ย function showScreen(id) { document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active')); document.getElementById(id).classList.add('active'); }
ย ย ย ย function toRegister() { showScreen('register'); }
ย ย ย ย function toLogin() { showScreen('login'); }
ย ย ย ยย
ย ย ย ย async function doLogin() { try { await auth.signInWithEmailAndPassword(document.getElementById('log-email').value, document.getElementById('log-pass').value); } catch(e) { showToast(e.message); } }
ย ย ย ยย
ย ย ย ย async function doRegister() {
ย ย ย ย ย ย if(document.getElementById('reg-code').value !== SECRET_CODE) return showToast("Cรณdigo incorrecto");
ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย const email = document.getElementById('reg-email').value;
ย ย ย ย ย ย ย ย const isAdmin = email.toLowerCase() === ADMIN_EMAIL;
ย ย ย ย ย ย ย ย const cred = await auth.createUserWithEmailAndPassword(email, document.getElementById('reg-pass').value);
ย ย ย ย ย ย ย ย await db.collection('users').doc(cred.user.uid).set({
ย ย ย ย ย ย ย ย ย ย username: document.getElementById('reg-name').value,ย
ย ย ย ย ย ย ย ย ย ย email,ย
ย ย ย ย ย ย ย ย ย ย age: document.getElementById('reg-age').value,
ย ย ย ย ย ย ย ย ย ย height: document.getElementById('reg-height').value,
ย ย ย ย ย ย ย ย ย ย role: isAdmin?'admin':'user', approved: isAdmin,ย
ย ย ย ย ย ย ย ย ย ย settings:{rest:60, screen:true, sound:true, goal:'Mantenimiento', alarmDay: -1},
ย ย ย ย ย ย ย ย ย ย stats:{kg:0, workouts:0, sets:0, reps:0, heatmap:{}},
ย ย ย ย ย ย ย ย ย ย targets:{kcal:0, water:0},
ย ย ย ย ย ย ย ย ย ย createdAt: firebase.firestore.FieldValue.serverTimestamp()
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย ย ย showToast(isAdmin?"Hola Jefe":"Solicitud Enviada");
ย ย ย ย ย ย ย ย if(!isAdmin) showScreen('login');
ย ย ย ย ย ย } catch(e) { showToast(e.message); }
ย ย ย ย }

ย ย ย ย // 6. APP INIT & ALARMS
ย ย ย ย function checkAlarms() {
ย ย ย ย ย ย if(!userData.settings.alarmDay || userData.settings.alarmDay == -1) return;
ย ย ย ย ย ย const now = new Date();
ย ย ย ย ย ย const today = now.getDay();
ย ย ย ย ย ยย
ย ย ย ย ย ย // Si coincide el dรญa y no se ha mostrado hoy
ย ย ย ย ย ย const lastCheck = localStorage.getItem('last_photo_alarm');
ย ย ย ย ย ย const todayStr = now.toDateString();
ย ย ย ย ย ยย
ย ย ย ย ย ย if(today == userData.settings.alarmDay && lastCheck !== todayStr) {
ย ย ย ย ย ย ย ย // Verificar hora si se configurรณ (opcional, aquรญ simplificado a aviso al abrir)
ย ย ย ย ย ย ย ย alert("๐ธ RECORDATORIO: ยกHoy toca subir foto de revisiรณn!");
ย ย ย ย ย ย ย ย localStorage.setItem('last_photo_alarm', todayStr);
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย function checkAdminAlerts() {
ย ย ย ย ย ย db.collection('users').doc(currentUser.uid).collection('notifications').where('read','==',false).onSnapshot(snap => {
ย ย ย ย ย ย ย ย snap.forEach(d => {
ย ย ย ย ย ย ย ย ย ย alert("Mensaje del Coach: " + d.data().msg);
ย ย ย ย ย ย ย ย ย ย db.collection('users').doc(currentUser.uid).collection('notifications').doc(d.id).update({read:true});
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย });
ย ย ย ย }

ย ย ย ย async function initApp() {
ย ย ย ย ย ย showScreen('app'); nav('view-home');
ย ย ย ย ย ย document.getElementById('u-name').innerText = userData.username.split(' ')[0];
ย ย ย ย ย ย document.getElementById('u-goal').innerText = userData.settings.goal || 'Objetivo no fijado';
ย ย ย ย ย ยย
ย ย ย ย ย ย if(userData.targets && (userData.targets.kcal > 0 || userData.targets.water > 0)) {
ย ย ย ย ย ย ย ย document.getElementById('nutrition-panel').classList.remove('hidden');
ย ย ย ย ย ย ย ย document.getElementById('target-kcal').innerText = userData.targets.kcal || '-';
ย ย ย ย ย ย ย ย document.getElementById('target-water').innerText = userData.targets.water || '-';
ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย document.getElementById('nutrition-panel').classList.add('hidden');
ย ย ย ย ย ย }

ย ย ย ย ย ย if(userData.role === 'admin') document.getElementById('admin-btn').classList.remove('hidden');
ย ย ย ย ย ยย
ย ย ย ย ย ย // Cargar Config
ย ย ย ย ย ย document.getElementById('cfg-goal').value = userData.settings.goal || 'Mantenimiento';
ย ย ย ย ย ย document.getElementById('cfg-rest').value = userData.settings.rest || 60;
ย ย ย ย ย ย document.getElementById('cfg-screen').checked = userData.settings.screen;
ย ย ย ย ย ย document.getElementById('cfg-sound').checked = userData.settings.sound;
ย ย ย ย ย ย document.getElementById('cfg-alarm-day').value = userData.settings.alarmDay || -1;
ย ย ย ย ย ย // Hora alarma (si existiera en DB)
ย ย ย ย ย ย if(userData.settings.alarmTime) document.getElementById('cfg-alarm-time').value = userData.settings.alarmTime;

ย ย ย ย ย ย loadRoutines(); loadProfile();
ย ย ย ย }

ย ย ย ย function nav(vid) {
ย ย ย ย ย ย document.querySelectorAll('.view').forEach(v=>v.classList.add('hidden'));
ย ย ย ย ย ย document.getElementById(vid).classList.remove('hidden');
ย ย ย ย ย ย document.querySelectorAll('.nav-item').forEach(b=>b.classList.remove('active'));
ย ย ย ย ย ย if(vid.includes('home')) document.querySelector('.nav-item:nth-child(1)').classList.add('active');
ย ย ย ย ย ย if(vid.includes('profile')) document.querySelector('.nav-item:nth-child(2)').classList.add('active');
ย ย ย ย ย ย if(vid.includes('config')) document.querySelector('.nav-item:nth-child(3)').classList.add('active');
ย ย ย ย }

ย ย ย ย // 7. DASHBOARD & ROUTINES
ย ย ย ย async function loadRoutines() {
ย ย ย ย ย ย const l = document.getElementById('routines-list');ย
ย ย ย ย ย ย db.collection('users').doc(currentUser.uid).collection('routines').orderBy('createdAt','desc').onSnapshot(s => {
ย ย ย ย ย ย ย ย l.innerHTML = '';
ย ย ย ย ย ย ย ย if(s.empty) l.innerHTML = '<p style="color:#666;">No tienes rutinas asignadas.</p>';
ย ย ย ย ย ย ย ย s.forEach(d => {
ย ย ย ย ย ย ย ย ย ย const r = d.data();
ย ย ย ย ย ย ย ย ย ย const icons = r.exercises.slice(0,5).map(e=>`<img src="${e.image}" style="width:30px; height:30px; margin-right:5px; border-radius:4px; object-fit:cover;">`).join('');
ย ย ย ย ย ย ย ย ย ย const div = document.createElement('div'); div.className='card';
ย ย ย ย ย ย ย ย ย ย div.innerHTML = `
ย ย ย ย ย ย ย ย ย ย ย ย <div style="display:flex; justify-content:space-between;"><h3>${r.name}</h3>
ย ย ย ย ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button onclick="editRout('${d.id}')" class="btn-icon">โ๏ธ</button>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button onclick="delRout('${d.id}')" class="btn-icon">๐๏ธ</button>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย <div style="margin:10px 0;">${icons}</div>
ย ย ย ย ย ย ย ย ย ย ย ย <button onclick="startWo('${d.id}')" class="btn btn-primary">ENTRENAR</button>`;
ย ย ย ย ย ย ย ย ย ย l.appendChild(div);
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย });
ย ย ย ย }

ย ย ย ย async function saveDailyNutrition() {
ย ย ย ย ย ย const k = document.getElementById('user-kcal').value;
ย ย ย ย ย ย const w = document.getElementById('user-water').value;
ย ย ย ย ย ย await db.collection('users').doc(currentUser.uid).collection('nutrition').add({
ย ย ย ย ย ย ย ย kcal: k, water: w, date: firebase.firestore.FieldValue.serverTimestamp()
ย ย ย ย ย ย });
ย ย ย ย ย ย showToast("Registro guardado");
ย ย ย ย }

ย ย ย ย // 8. AUTOGUARDADO & WORKOUT CORE
ย ย ย ย function saveWorkoutToStorage() {
ย ย ย ย ย ย if (activeRoutine) {
ย ย ย ย ย ย ย ย localStorage.setItem('fitdata_wo', JSON.stringify({routine: activeRoutine, start: woStartTime}));
ย ย ย ย ย ย }
ย ย ย ย }
ย ย ย ย function loadWorkoutFromStorage() {
ย ย ย ย ย ย const saved = localStorage.getItem('fitdata_wo');
ย ย ย ย ย ย if(saved) {
ย ย ย ย ย ย ย ย const data = JSON.parse(saved);
ย ย ย ย ย ย ย ย if(new Date() - new Date(data.start) < 3*60*60*1000) {
ย ย ย ย ย ย ย ย ย ย if(confirm("ยฟRecuperar entreno anterior?")) {
ย ย ย ย ย ย ย ย ย ย ย ย activeRoutine = data.routine;
ย ย ย ย ย ย ย ย ย ย ย ย woStartTime = new Date(data.start);
ย ย ย ย ย ย ย ย ย ย ย ย renderWorkoutScreen();
ย ย ย ย ย ย ย ย ย ย } else localStorage.removeItem('fitdata_wo');
ย ย ย ย ย ย ย ย } else localStorage.removeItem('fitdata_wo');
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย async function startWo(id) {
ย ย ย ย ย ย const doc = await db.collection('users').doc(currentUser.uid).collection('routines').doc(id).get();
ย ย ย ย ย ย const r = doc.data();ย
ย ย ย ย ย ย const preparedExercises = r.exercises.map(ex => ({
ย ย ย ย ย ย ย ย ...ex,
ย ย ย ย ย ย ย ย series: Array(5).fill().map((_, i) => ({ weight: '', reps: i===0?20:16, completed: false }))
ย ย ย ย ย ย }));

ย ย ย ย ย ย activeRoutine = {id, name: r.name, exercises: preparedExercises};
ย ย ย ย ย ย woStartTime = new Date();
ย ย ย ย ย ยย
ย ย ย ย ย ย if(userData.settings.screen && 'wakeLock' in navigator) try{ wakeLock=await navigator.wakeLock.request('screen'); }catch(e){}
ย ย ย ย ย ย saveWorkoutToStorage();
ย ย ย ย ย ย renderWorkoutScreen();
ย ย ย ย }

ย ย ย ย async function renderWorkoutScreen() {
ย ย ย ย ย ย document.getElementById('workout-ui').classList.add('active');
ย ย ย ย ย ย document.getElementById('wo-title').innerText = activeRoutine.name;
ย ย ย ย ย ย const c = document.getElementById('wo-container'); c.innerHTML='';

ย ย ย ย ย ย let lastWorkout = null;
ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย const hSnap = await db.collection('users').doc(currentUser.uid).collection('history')
ย ย ย ย ย ย ย ย ย ย .where('routineId','==',activeRoutine.id).orderBy('date','desc').limit(1).get();
ย ย ย ย ย ย ย ย if(!hSnap.empty) lastWorkout = hSnap.docs[0].data();
ย ย ย ย ย ย } catch(e) { console.log("No history found"); }

ย ย ย ย ย ย activeRoutine.exercises.forEach((ex, idx) => {
ย ย ย ย ย ย ย ย let rows = '';
ย ย ย ย ย ย ย ย ex.series.forEach((s, i) => {
ย ย ย ย ย ย ย ย ย ย const prev = lastWorkout?.exercises?.[idx]?.series?.[i]?.weight || '-';
ย ย ย ย ย ย ย ย ย ย const rowClass = s.completed ? 'set-row done' : 'set-row';
ย ย ย ย ย ย ย ย ย ย const checkClass = s.completed ? 'check-btn checked' : 'check-btn';
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย rows += `
ย ย ย ย ย ย ย ย ย ย <div class="${rowClass}" id="row-${idx}-${i}">
ย ย ย ย ย ย ย ย ย ย ย ย <div style="text-align:center; color:#888;">${i+1}</div>
ย ย ย ย ย ย ย ย ย ย ย ย <input type="number" class="input reps" value="${s.reps}" onchange="updateSet(${idx},${i},'reps',this.value)" style="margin:0; text-align:center; height:35px; background:#333;">
ย ย ย ย ย ย ย ย ย ย ย ย <div style="position:relative;">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="prev-val">${prev}kg</span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <input type="number" class="input weight" value="${s.weight}" onchange="updateSet(${idx},${i},'weight',this.value)" placeholder="kg" style="margin:0; text-align:center; height:35px; background:#333;">
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย <div class="${checkClass}" onclick="checkSet(this, ${idx}, ${i})">โ</div>
ย ย ย ย ย ย ย ย ย ย </div>`;
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย const card = document.createElement('div');
ย ย ย ย ย ย ย ย card.className = 'card';
ย ย ย ย ย ย ย ย card.innerHTML = `
ย ย ย ย ย ย ย ย ย ย <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
ย ย ย ย ย ย ย ย ย ย ย ย <div style="display:flex; align-items:center; gap:10px;">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <img src="${ex.image}" class="ex-img">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <h4>${ex.name}</h4>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย <button onclick="openNote(${idx})" class="btn-icon">๐</button>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ${rows}`;
ย ย ย ย ย ย ย ย c.appendChild(card);
ย ย ย ย ย ย });

ย ย ย ย ย ย if(woTimerInt) clearInterval(woTimerInt);
ย ย ย ย ย ย woTimerInt = setInterval(()=>{
ย ย ย ย ย ย ย ย const d = Math.floor((new Date()-woStartTime)/1000);
ย ย ย ย ย ย ย ย document.getElementById('wo-timer').innerText = `${Math.floor(d/60).toString().padStart(2,'0')}:${(d%60).toString().padStart(2,'0')}`;
ย ย ย ย ย ย },1000);
ย ย ย ย }

ย ย ย ย function updateSet(exIdx, sIdx, field, val) {
ย ย ย ย ย ย activeRoutine.exercises[exIdx].series[sIdx][field] = val;
ย ย ย ย ย ย saveWorkoutToStorage();
ย ย ย ย }

ย ย ย ย function checkSet(btn, exIdx, sIdx) {
ย ย ย ย ย ย if(btn.classList.contains('checked')) return;
ย ย ย ย ย ย btn.classList.add('checked');ย
ย ย ย ย ย ย document.getElementById(`row-${exIdx}-${sIdx}`).classList.add('done');
ย ย ย ย ย ย activeRoutine.exercises[exIdx].series[sIdx].completed = true;
ย ย ย ย ย ย saveWorkoutToStorage();

ย ย ย ย ย ย const s = activeRoutine.exercises[exIdx].series[sIdx];
ย ย ย ย ย ย if(s.weight > 0) {
ย ย ย ย ย ย ย ย const onerm = s.weight * (1 + s.reps/30);
ย ย ย ย ย ย ย ย if(s.weight > 80) showToast(`๐ ยกRรฉcord! 1RM: ${Math.round(onerm)}kg`);ย
ย ย ย ย ย ย }
ย ย ย ย ย ย startRest();
ย ย ย ย }

ย ย ย ย function startRest() {
ย ย ย ย ย ย const t = document.getElementById('float-timer');ย
ย ย ย ย ย ย const val = document.getElementById('timer-val');
ย ย ย ย ย ย t.classList.remove('hidden');
ย ย ย ย ย ย let sec = userData.settings.rest || 60; val.innerText = sec;
ย ย ย ย ย ยย
ย ย ย ย ย ย if(restTimerInt) clearInterval(restTimerInt);
ย ย ย ย ย ย restTimerInt = setInterval(()=>{
ย ย ย ย ย ย ย ย sec--; val.innerText=sec;
ย ย ย ย ย ย ย ย if(sec<=0) {ย
ย ย ย ย ย ย ย ย ย ย clearInterval(restTimerInt); t.classList.add('hidden');ย
ย ย ย ย ย ย ย ย ย ย if(userData.settings.sound) document.getElementById('beep').play().catch(e=>{});ย
ย ย ย ย ย ย ย ย ย ย navigator.vibrate(500);ย
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย },1000);
ย ย ย ย }
ย ย ย ย function addTime() { let v = document.getElementById('timer-val'); v.innerText = parseInt(v.innerText)+30; }
ย ย ย ย function stopRest() { clearInterval(restTimerInt); document.getElementById('float-timer').classList.add('hidden'); }
ย ย ย ย function finishPrompt() { document.getElementById('modal-rpe').classList.remove('hidden'); }
ย ย ย ยย
ย ย ย ย async function saveWorkoutLog(rpe) {
ย ย ย ย ย ย document.getElementById('modal-rpe').classList.add('hidden');
ย ย ย ย ย ย let totalKg=0, totalSets=0, totalReps=0;
ย ย ย ย ย ย let muscleMap = userData.stats?.heatmap || {};

ย ย ย ย ย ย activeRoutine.exercises.forEach(ex => {
ย ย ย ย ย ย ย ย ex.series.forEach(s => {
ย ย ย ย ย ย ย ย ย ย if(s.completed) {
ย ย ย ย ย ย ย ย ย ย ย ย totalKg += (parseFloat(s.weight)||0) * (parseFloat(s.reps)||0);
ย ย ย ย ย ย ย ย ย ย ย ย totalSets++;
ย ย ย ย ย ย ย ย ย ย ย ย totalReps += parseFloat(s.reps)||0;
ย ย ย ย ย ย ย ย ย ย ย ย muscleMap[ex.muscle] = (muscleMap[ex.muscle] || 0) + 1;
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย });

ย ย ย ย ย ย const newStats = {
ย ย ย ย ย ย ย ย kg: (userData.stats?.kg||0) + totalKg,
ย ย ย ย ย ย ย ย sets: (userData.stats?.sets||0) + totalSets,
ย ย ย ย ย ย ย ย reps: (userData.stats?.reps||0) + totalReps,
ย ย ย ย ย ย ย ย workouts: (userData.stats?.workouts||0) + 1,
ย ย ย ย ย ย ย ย heatmap: muscleMap
ย ย ย ย ย ย };

ย ย ย ย ย ย await db.collection('users').doc(currentUser.uid).update({ stats: newStats });
ย ย ย ย ย ย await db.collection('users').doc(currentUser.uid).collection('history').add({
ย ย ย ย ย ย ย ย date: firebase.firestore.FieldValue.serverTimestamp(),
ย ย ย ย ย ย ย ย routineId: activeRoutine.id, routineName: activeRoutine.name,
ย ย ย ย ย ย ย ย duration: Math.floor((new Date()-woStartTime)/1000), rpe,ย
ย ย ย ย ย ย ย ย exercises: activeRoutine.exercises
ย ย ย ย ย ย });

ย ย ย ย ย ย if(wakeLock) wakeLock.release();
ย ย ย ย ย ย localStorage.removeItem('fitdata_wo');
ย ย ย ย ย ย exitWorkout(); showToast("Entreno Guardado ๐");
ย ย ย ย }
ย ย ย ย function exitWorkout() { document.getElementById('workout-ui').classList.remove('active'); stopRest(); initApp(); }

ย ย ย ย function openNote(exIdx) {
ย ย ย ย ย ย currentNoteExId = exIdx;
ย ย ย ย ย ย document.getElementById('modal-note').classList.remove('hidden');
ย ย ย ย }
ย ย ย ย function saveNote() {
ย ย ย ย ย ย showToast("Nota guardada");
ย ย ย ย ย ย document.getElementById('modal-note').classList.add('hidden');
ย ย ย ย }

ย ย ย ย // 9. PROFILE & STATS
ย ย ย ย function loadProfile() {
ย ย ย ย ย ย const s = userData.stats || {kg:0, workouts:0, sets:0, reps:0, heatmap:{}};
ย ย ย ย ย ย document.getElementById('stat-kg').innerText = (s.kg/1000).toFixed(1) + 't';
ย ย ย ย ย ย document.getElementById('stat-workouts').innerText = s.workouts;
ย ย ย ย ย ย document.getElementById('stat-sets').innerText = s.sets;
ย ย ย ย ย ย document.getElementById('stat-reps').innerText = s.reps;
ย ย ย ย ย ย renderHeatmap(s.heatmap || {});
ย ย ย ย ย ย loadGraph(); loadPhotos();
ย ย ย ย }

ย ย ย ย async function saveConfig() {
ย ย ย ย ย ย const goal = document.getElementById('cfg-goal').value;
ย ย ย ย ย ย const screen = document.getElementById('cfg-screen').checked;
ย ย ย ย ย ย const sound = document.getElementById('cfg-sound').checked;
ย ย ย ย ย ย const rest = parseInt(document.getElementById('cfg-rest').value);
ย ย ย ย ย ย const alarmDay = parseInt(document.getElementById('cfg-alarm-day').value);
ย ย ย ย ย ย const alarmTime = document.getElementById('cfg-alarm-time').value;
ย ย ย ย ย ยย
ย ย ย ย ย ย await db.collection('users').doc(currentUser.uid).update({
ย ย ย ย ย ย ย ย 'settings.goal': goal, 'settings.screen': screen, 'settings.sound': sound, 'settings.rest': rest,ย
ย ย ย ย ย ย ย ย 'settings.alarmDay': alarmDay, 'settings.alarmTime': alarmTime
ย ย ย ย ย ย });
ย ย ย ย ย ย userData.settings = { goal, screen, sound, rest, alarmDay, alarmTime };
ย ย ย ย ย ย showToast("Perfil Actualizado");
ย ย ย ย }

ย ย ย ย async function loadGraph() {
ย ย ย ย ย ย const ctx = document.getElementById('weightChart').getContext('2d');
ย ย ย ย ย ย const s = await db.collection('users').doc(currentUser.uid).collection('weights').orderBy('date','asc').limit(10).get();
ย ย ย ย ย ย const d = s.docs.map(x => ({x: x.data().date.toDate().toLocaleDateString(), y: x.data().val}));
ย ย ย ย ย ย if(weightChart) weightChart.destroy();
ย ย ย ย ย ย weightChart = new Chart(ctx, { type:'line', data:{labels:d.map(i=>i.x), datasets:[{label:'Peso', data:d.map(i=>i.y), borderColor:'#ff4444', backgroundColor:'rgba(255,68,68,0.1)', fill:true}]}, options:{scales:{y:{beginAtZero:false}}, plugins:{legend:{display:false}}} });
ย ย ย ย }
ย ย ย ย async function saveWeight() {
ย ย ย ย ย ย const val = parseFloat(document.getElementById('new-weight').value);
ย ย ย ย ย ย if(!val) return;
ย ย ย ย ย ย await db.collection('users').doc(currentUser.uid).collection('weights').add({val, date:firebase.firestore.FieldValue.serverTimestamp()});
ย ย ย ย ย ย loadGraph(); showToast("Peso registrado");
ย ย ย ย }
ย ย ย ยย
ย ย ย ย async function uploadPhoto(inp) {
ย ย ย ย ย ย const f = inp.files[0];
ย ย ย ย ย ย if(!f) return;
ย ย ย ย ย ย const img = new Image(); img.src = URL.createObjectURL(f);
ย ย ย ย ย ย img.onload = async () => {
ย ย ย ย ย ย ย ย const cvs = document.createElement('canvas'); const ctx = cvs.getContext('2d');
ย ย ย ย ย ย ย ย const sc = 600/img.width; cvs.width=600; cvs.height=img.height*sc;
ย ย ย ย ย ย ย ย ctx.drawImage(img,0,0,cvs.width,cvs.height);
ย ย ย ย ย ย ย ย const b64 = cvs.toDataURL('image/jpeg', 0.6);
ย ย ย ย ย ย ย ย await db.collection('users').doc(currentUser.uid).collection('photos').add({img:b64, date:firebase.firestore.FieldValue.serverTimestamp()});
ย ย ย ย ย ย ย ย showToast("Foto subida"); loadPhotos();
ย ย ย ย ย ย }
ย ย ย ย }
ย ย ย ย async function loadPhotos() {
ย ย ย ย ย ย const g = document.getElementById('gallery'); g.innerHTML='';
ย ย ย ย ย ย const s = await db.collection('users').doc(currentUser.uid).collection('photos').orderBy('date','desc').get();
ย ย ย ย ย ย const p = s.docs.map(d=>d.data());
ย ย ย ย ย ย if(p.length) {
ย ย ย ย ย ย ย ย document.getElementById('comp-before').innerHTML = `<img src="${p[p.length-1].img}" style="width:100%; height:100%; object-fit:cover;">`;
ย ย ย ย ย ย ย ย document.getElementById('comp-now').innerHTML = `<img src="${p[0].img}" style="width:100%; height:100%; object-fit:cover;">`;
ย ย ย ย ย ย }
ย ย ย ย ย ย p.forEach(x => {
ย ย ย ย ย ย ย ย const d = document.createElement('div'); d.className='photo-item';
ย ย ย ย ย ย ย ย d.innerHTML = `<img src="${x.img}"><div class="photo-date">${x.date?x.date.toDate().toLocaleDateString():''}</div>`;
ย ย ย ย ย ย ย ย g.appendChild(d);
ย ย ย ย ย ย });
ย ย ย ย }

ย ย ย ย // --- 10. ADMIN REAL-TIME ---
ย ย ย ย function listenToAllUsers() {
ย ย ย ย ย ย db.collection('users').orderBy('createdAt','desc').onSnapshot(snap => {
ย ย ย ย ย ย ย ย const pend = document.getElementById('adm-pending'); const usrs = document.getElementById('adm-users');
ย ย ย ย ย ย ย ย const count = document.getElementById('count-pending');
ย ย ย ย ย ย ย ย pend.innerHTML=''; usrs.innerHTML='';
ย ย ย ย ย ย ย ย let pCount=0;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย snap.forEach(d => {
ย ย ย ย ย ย ย ย ย ย const u = d.data();
ย ย ย ย ย ย ย ย ย ย const item = `
ย ย ย ย ย ย ย ย ย ย <div class="user-row">
ย ย ย ย ย ย ย ย ย ย ย ย <div><b>${u.username}</b><br><small style="color:#888">${u.email}</small>
ย ย ย ย ย ย ย ย ย ย ย ย <br><span class="stat-badge">${u.settings?.goal || '-'}</span></div>
ย ย ย ย ย ย ย ย ย ย ย ย <div style="text-align:right;">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button onclick="sendAlert('${d.id}')" class="btn-icon">๐</button>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button onclick="assignRout('${d.id}', '${u.username}')" class="btn-secondary" style="font-size:0.8rem; padding:4px;">๐ Rutina</button>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ${u.approved ? `<button onclick="viewUserAdmin('${d.id}')" class="btn-icon">๐๏ธ</button>` :ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย `<button onclick="approve('${d.id}')" class="btn-success" style="padding:4px 8px; width:auto; font-size:0.8rem;">OK</button>`}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button onclick="delUser('${d.id}')" style="background:none; border:none; color:#666;">โ</button>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย </div>`;
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย if(!u.approved && u.role!=='admin') { pend.innerHTML+=item; pCount++; }
ย ย ย ย ย ย ย ย ย ย else if(u.role!=='admin') usrs.innerHTML+=item;
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย if(pend.innerHTML==='') pend.innerHTML = '<p class="text-muted">Nada pendiente</p>';
ย ย ย ย ย ย ย ย if(count) count.innerText = pCount;
ย ย ย ย ย ย });
ย ย ย ย }

ย ย ย ย async function viewUserAdmin(uid) {
ย ย ย ย ย ย currentAdminUser = uid;
ย ย ย ย ย ย document.getElementById('modal-athlete').classList.remove('hidden');

ย ย ย ย ย ย const uDoc = await db.collection('users').doc(uid).get();
ย ย ย ย ย ย const u = uDoc.data();
ย ย ย ย ย ยย
ย ย ย ย ย ย document.getElementById('adm-ath-name').innerText = u.username;
ย ย ย ย ย ย document.getElementById('adm-set-kcal').value = u.targets?.kcal || '';
ย ย ย ย ย ย document.getElementById('adm-set-water').value = u.targets?.water || '';
ย ย ย ย ย ย document.getElementById('adm-ath-age').innerText = u.age || '-';
ย ย ย ย ย ย document.getElementById('adm-ath-height').innerText = u.height || '-';
ย ย ย ย ย ย document.getElementById('adm-ath-kg').innerText = (u.stats?.kg/1000).toFixed(1) + 't';
ย ย ย ย ย ย document.getElementById('adm-ath-sets').innerText = u.stats?.sets || 0;

ย ย ย ย ย ย const ctx = document.getElementById('adminWeightChart').getContext('2d');
ย ย ย ย ย ย const wSnap = await db.collection('users').doc(uid).collection('weights').orderBy('date','asc').limit(10).get();
ย ย ย ย ย ย const data = wSnap.docs.map(x => ({x: x.data().date.toDate().toLocaleDateString(), y: x.data().val}));
ย ย ย ย ย ยย
ย ย ย ย ย ย if(adminWeightChart) adminWeightChart.destroy();
ย ย ย ย ย ย adminWeightChart = new Chart(ctx, { type:'line', data:{labels:data.map(i=>i.x), datasets:[{label:'Peso', data:data.map(i=>i.y), borderColor:'#ff4444'}]} });

ย ย ย ย ย ย const pSnap = await db.collection('users').doc(uid).collection('photos').orderBy('date','desc').limit(4).get();
ย ย ย ย ย ย const gallery = document.getElementById('admin-gallery'); gallery.innerHTML='';
ย ย ย ย ย ย pSnap.forEach(d => { gallery.innerHTML += `<div class="photo-item"><img src="${d.data().img}" style="width:100%;"></div>`; });
ย ย ย ย }

ย ย ย ย function closeAdminModal() { document.getElementById('modal-athlete').classList.add('hidden'); }

ย ย ย ย async function adminSaveTargets() {
ย ย ย ย ย ย const k = document.getElementById('adm-set-kcal').value;
ย ย ย ย ย ย const w = document.getElementById('adm-set-water').value;
ย ย ย ย ย ย await db.collection('users').doc(currentAdminUser).update({ 'targets.kcal': k, 'targets.water': w });
ย ย ย ย ย ย showToast("Objetivos actualizados");
ย ย ย ย ย ย document.getElementById('modal-athlete').classList.add('hidden');
ย ย ย ย }

ย ย ย ย // ALERTAS ADMIN
ย ย ย ย function sendAlert(uid) {
ย ย ย ย ย ย currentAdminUser = uid;
ย ย ย ย ย ย document.getElementById('modal-alert').classList.remove('hidden');
ย ย ย ย }
ย ย ย ย async function sendAdminAlert() {
ย ย ย ย ย ย const msg = document.getElementById('alert-msg').value;
ย ย ย ย ย ย if(!msg) return;
ย ย ย ย ย ย await db.collection('users').doc(currentAdminUser).collection('notifications').add({msg: msg, read: false, date: new Date()});
ย ย ย ย ย ย showToast("Alerta enviada");
ย ย ย ย ย ย document.getElementById('modal-alert').classList.add('hidden');
ย ย ย ย }

ย ย ย ย async function approve(id) { await db.collection('users').doc(id).update({approved:true}); }
ย ย ย ย async function delUser(id) { if(confirm("Borrar?")) await db.collection('users').doc(id).delete(); }
ย ย ย ยย
ย ย ย ย function assignRout(uid, uname) {
ย ย ย ย ย ย adminAssignTarget = uid;
ย ย ย ย ย ย document.getElementById('modal-routine-title').innerText = "Asignar a " + uname;
ย ย ย ย ย ย document.getElementById('routine-target-msg').classList.remove('hidden');
ย ย ย ย ย ย document.getElementById('target-user-name').innerText = uname;
ย ย ย ย ย ยย
ย ย ย ย ย ย selectedExs = [];
ย ย ย ย ย ย document.getElementById('new-rout-name').value = '';
ย ย ย ย ย ย renderExSelector();
ย ย ย ย ย ย document.getElementById('modal-create').classList.remove('hidden');
ย ย ย ย }

ย ย ย ย // --- UTILS ---
ย ย ย ย function openRoutineModal() {ย
ย ย ย ย ย ย editingRoutineId = null;ย
ย ย ย ย ย ย adminAssignTarget = null;
ย ย ย ย ย ย document.getElementById('modal-routine-title').innerText = "Nueva Rutina";
ย ย ย ย ย ย document.getElementById('routine-target-msg').classList.add('hidden');
ย ย ย ย ย ยย
ย ย ย ย ย ย selectedExs=[];ย
ย ย ย ย ย ย document.getElementById('new-rout-name').value='';ย
ย ย ย ย ย ย renderExSelector();ย
ย ย ย ย ย ย document.getElementById('modal-create').classList.remove('hidden');ย
ย ย ย ย }

ย ย ย ย async function editRout(id) {
ย ย ย ย ย ย const doc = await db.collection('users').doc(currentUser.uid).collection('routines').doc(id).get();
ย ย ย ย ย ย const r = doc.data();
ย ย ย ย ย ยย
ย ย ย ย ย ย editingRoutineId = id;
ย ย ย ย ย ย document.getElementById('modal-routine-title').innerText = "Editar Rutina";
ย ย ย ย ย ย document.getElementById('new-rout-name').value = r.name;
ย ย ย ย ย ย selectedExs = r.exercises.map(e => e.id);
ย ย ย ย ย ยย
ย ย ย ย ย ย renderExSelector();
ย ย ย ย ย ย document.getElementById('modal-create').classList.remove('hidden');
ย ย ย ย }

ย ย ย ย function renderExSelector() {
ย ย ย ย ย ย const f = document.getElementById('search-ex').value.toLowerCase();
ย ย ย ย ย ย const c = document.getElementById('ex-list'); c.innerHTML='';
ย ย ย ย ย ย exercisesDB.filter(e=>e.name.toLowerCase().includes(f)).forEach(e => {
ย ย ย ย ย ย ย ย const d = document.createElement('div');
ย ย ย ย ย ย ย ย d.style.cssText = `display:flex; align-items:center; gap:10px; padding:8px; border-bottom:1px solid #333; cursor:pointer; ${selectedExs.includes(e.id)?'background:rgba(255,68,68,0.2)':''}`;
ย ย ย ย ย ย ย ย d.innerHTML = `<img src="${e.image}" style="width:40px; background:white; border-radius:4px; object-fit:cover;"><div><b>${e.name}</b><br><small style="color:#888">${e.muscle}</small></div>`;
ย ย ย ย ย ย ย ย d.onclick = ()=>{ย
ย ย ย ย ย ย ย ย ย ย if(selectedExs.includes(e.id)) selectedExs=selectedExs.filter(x=>x!==e.id);ย
ย ย ย ย ย ย ย ย ย ย else selectedExs.push(e.id);ย
ย ย ย ย ย ย ย ย ย ย renderExSelector();ย
ย ย ย ย ย ย ย ย };
ย ย ย ย ย ย ย ย c.appendChild(d);
ย ย ย ย ย ย });
ย ย ย ย }

ย ย ย ย async function saveRoutine() {
ย ย ย ย ย ย const name = document.getElementById('new-rout-name').value;
ย ย ย ย ย ย if(!name || selectedExs.length === 0) return showToast("Faltan datos");
ย ย ย ย ย ยย
ย ย ย ย ย ย const exs = selectedExs.map(id => exercisesDB.find(e => e.id === id)).filter(e => e !== undefined);
ย ย ย ย ย ยย
ย ย ย ย ย ย if(exs.length === 0) return showToast("Error al procesar ejercicios");

ย ย ย ย ย ย if(adminAssignTarget) {
ย ย ย ย ย ย ย ย await db.collection('users').doc(adminAssignTarget).collection('routines').add({
ย ย ย ย ย ย ย ย ย ย name, exercises: exs, createdAt: firebase.firestore.FieldValue.serverTimestamp()
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย ย ย showToast("Rutina asignada al cliente");
ย ย ย ย ย ย }ย
ย ย ย ย ย ย else if(editingRoutineId) {
ย ย ย ย ย ย ย ย await db.collection('users').doc(currentUser.uid).collection('routines').doc(editingRoutineId).update({
ย ย ย ย ย ย ย ย ย ย name, exercises: exs
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย ย ย showToast("Rutina actualizada");
ย ย ย ย ย ย }ย
ย ย ย ย ย ย else {
ย ย ย ย ย ย ย ย await db.collection('users').doc(currentUser.uid).collection('routines').add({
ย ย ย ย ย ย ย ย ย ย name, exercises: exs, createdAt: firebase.firestore.FieldValue.serverTimestamp()
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย ย ย showToast("Rutina creada");
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย document.getElementById('modal-create').classList.add('hidden');
ย ย ย ย ย ย editingRoutineId = null;
ย ย ย ย ย ย adminAssignTarget = null;
ย ย ย ย }

ย ย ย ย async function delRout(id) { if(confirm("ยฟBorrar?")) await db.collection('users').doc(currentUser.uid).collection('routines').doc(id).delete(); }
ย ย </script>
</body>
</html>
